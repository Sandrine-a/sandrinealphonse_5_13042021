(()=>{"use strict";let e="localhost"===location.hostname||"127.0.0.1"===location.hostname?"http://localhost:3000":"https://orinoco-cameras-shop.herokuapp.com",t=JSON.parse(localStorage.getItem("article"));const n=document.querySelector(".control__panier--total"),l=document.getElementById("order__btn"),o=(document.getElementById("panier__display"),document.getElementById("tab__header")),a=document.getElementById("panier__display--content"),i=document.getElementById("panier__display__message");let r=[];const c=document.querySelector(".form__section"),s=document.getElementById("needs-validation"),d=document.getElementById("firstName"),m=document.getElementById("lastName"),u=document.getElementById("adress"),p=document.getElementById("city"),y=document.getElementById("email");document.getElementById("zip"),l.addEventListener("click",(function(e){e.stopPropagation(),window.confirm("Souhaitez-vous vider entièrement votre panier?")&&(localStorage.clear(),location.reload())})),function(){let e=0;for(let n in t)e+=t[n].price*t[n].qty;n.innerHTML=`${e} €`}(),s.addEventListener("submit",(function t(n){!1===s.checkValidity()&&(n.preventDefault(),n.stopPropagation()),s.classList.add("was-validated"),async function(n){n.preventDefault(),await t();let l=r;const o={firstName:d.value,lastName:m.value,address:u.value,city:p.value,email:y.value};localStorage.setItem("contact",JSON.stringify(o));const a={contact:o,products:l};fetch(`${e}/api/cameras/order`,{method:"POST",body:JSON.stringify(a),headers:{Accept:"application/json","Content-Type":"application/json"}}).then((async e=>{try{const t=await e.json();if(e.ok)localStorage.setItem("orderId",t.orderId),window.location="confirmation.html";else{let t=document.createElement("div");t.innerHTML=`<p class="text-danger h4">\n        ERREUR Serveur: ${e.status} ${e.statusText}\n      </p>\n      `,s.appendChild(t)}}catch(e){let t=document.createElement("div");t.innerHTML=`<p class="text-danger h4">\n        ERREUR lors de l'envoi: ${e}\n      </p>\n      `,s.appendChild(t)}}))}(n)})),window.onload=()=>{null==t||0==t.length?(localStorage.clear(),o.classList.add("hide"),i.classList.remove("hide"),l.setAttribute("disabled","disabled"),c.style.display="none"):(function(){try{const e=document.querySelector(".header__cart--popup"),n=t&&t.length>0,l=e.className.includes("hide");if(n&&l){let n=0;for(let e in t)n+=t[e].qty;e.classList.remove("hide"),e.innerHTML=n}}catch{console.error("Erreur sur l'affichage de la pop up")}}(),function(){t.sort(((e,t)=>e.name>t.name?1:-1)),t.filter((function(e){return r.push(e.id)}));let e=r;localStorage.setItem("products",JSON.stringify(e));for(let e=0;e<t.length;e++){const n=document.createElement("article");n.classList.add("row","cart__item","mt-2"),n.innerHTML=`\n        <div class="col-3 cart__item--name">\n          <p>${t[e].name}</p>\n        </div>\n        <div class="col-3">\n          <p> ${t[e].price} €</p>\n        </div>\n        <div class="col-3 cart__item--qty">\n          <p class="item__qty"> ${t[e].qty} </p>\n        </div>\n        <div class="col-3" id="cart__item--btn">\n          <input type="button" class="btn btn-light btn-sm" id="btn__moins" value="-">\n          <input type="button" class="btn btn-light btn-sm" id="btn__plus" value="+" disabled> \n        </div>\n      `,a.appendChild(n)}}(),t.forEach((e=>{let t=document.querySelectorAll("#btn__plus"),n=!0;for(let l=0;l<t.length;l++){const o=t[l].parentElement.parentElement.firstElementChild.firstElementChild.textContent;if(e.qty>=20)return n;e.name===o&&(n=!1,t[l].removeAttribute("disabled"))}})),function(){const e=document.querySelectorAll("#btn__moins");let n=document.querySelectorAll("#btn__plus");for(let n=0;n<e.length;n++){const l=e[n].parentElement.parentElement.firstElementChild.firstElementChild.textContent;e[n].addEventListener("click",(function(e){e.stopPropagation(),t.forEach((e=>{e.name===l&&(e.qty--,0===e.qty&&(confirm(`Confirmez-vous la suppresion du ${e.name} ?`)?t=t.filter((e=>0!==e.qty)):e.qty++),localStorage.setItem("article",JSON.stringify(t)))})),location.reload()}))}for(let l=0;l<n.length;l++){const o=e[l].parentElement.parentElement.firstElementChild.firstElementChild.textContent;n[l].addEventListener("click",(function(e){e.stopPropagation(),t.forEach((e=>{e.name===o&&(e.qty++,e.qty>=20?window.alert(`Vous avez atteint le maximum de ${e.name}`):n[l].removeAttribute("disabled"),localStorage.setItem("article",JSON.stringify(t)))})),location.reload()}))}}())}})();