(()=>{"use strict";var e="localhost"===location.hostname||"127.0.0.1"===location.hostname?"http://localhost:3000":"https://orinoco-cameras-shop.herokuapp.com",t=JSON.parse(localStorage.getItem("article")),n=document.querySelector(".control__panier--total");function a(e,t,n,a,r,o,i){try{var c=e[o](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(a,r)}function r(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function c(e){a(i,r,o,c,l,"next",e)}function l(e){a(i,r,o,c,l,"throw",e)}c(void 0)}))}}var o=document.getElementById("order__btn"),i=(document.getElementById("panier__display"),document.getElementById("tab__header")),c=document.getElementById("panier__display--content"),l=document.getElementById("panier__display__message"),s=[],d=document.querySelector(".form__section"),u=document.getElementById("needs-validation"),m=document.getElementById("firstName"),p=document.getElementById("lastName"),f=document.getElementById("adress"),v=document.getElementById("city"),h=document.getElementById("email");function y(e){!1===u.checkValidity()&&(e.preventDefault(),e.stopPropagation()),u.classList.add("was-validated"),function(e){g.apply(this,arguments)}(e)}function g(){return(g=r(regeneratorRuntime.mark((function t(n){var a,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.next=3,y();case 3:a=s,o={firstName:m.value,lastName:p.value,address:f.value,city:v.value,email:h.value},localStorage.setItem("contact",JSON.stringify(o)),i={contact:o,products:a},fetch("".concat(e,"/api/cameras/order"),{method:"POST",body:JSON.stringify(i),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(){var e=r(regeneratorRuntime.mark((function e(t){var n,a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.json();case 3:n=e.sent,t.ok?(localStorage.setItem("orderId",n.orderId),window.location="confirmation.html"):((a=document.createElement("div")).innerHTML='<p class="text-danger h4">\n        ERREUR Serveur: '.concat(t.status," ").concat(t.statusText,"\n      </p>\n      "),u.appendChild(a)),e.next=12;break;case 7:e.prev=7,e.t0=e.catch(0),(r=document.createElement("div")).innerHTML='<p class="text-danger h4">\n        ERREUR lors de l\'envoi: '.concat(e.t0,"\n      </p>\n      "),u.appendChild(r);case 12:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}document.getElementById("zip"),o.addEventListener("click",(function(e){e.stopPropagation(),window.confirm("Souhaitez-vous vider entièrement votre panier?")&&(localStorage.clear(),location.reload())})),function(){var e=0;for(var a in t)e+=t[a].price*t[a].qty;n.innerHTML="".concat(e," €")}(),u.addEventListener("submit",y),window.onload=function(){null==t||0==t.length?(localStorage.clear(),i.classList.add("hide"),l.classList.remove("hide"),o.setAttribute("disabled","disabled"),d.style.display="none"):(function(){try{var e=document.querySelector(".header__cart--popup"),n=t&&t.length>0,a=e.className.includes("hide");if(n&&a){var r=0;for(var o in t)r+=t[o].qty;e.classList.remove("hide"),e.innerHTML=r}}catch(e){console.error("Erreur sur l'affichage de la pop up")}}(),function(){t.sort((function(e,t){return e.name>t.name?1:-1})),t.filter((function(e){return s.push(e.id)}));var e=s;localStorage.setItem("products",JSON.stringify(e));for(var n=0;n<t.length;n++){var a=document.createElement("article");a.classList.add("row","cart__item","mt-2"),a.innerHTML='\n        <div class="col-3 cart__item--name">\n          <p>'.concat(t[n].name,'</p>\n        </div>\n        <div class="col-3">\n          <p> ').concat(t[n].price,' €</p>\n        </div>\n        <div class="col-3 cart__item--qty">\n          <p class="item__qty"> ').concat(t[n].qty,' </p>\n        </div>\n        <div class="col-3" id="cart__item--btn">\n          <input type="button" class="btn btn-light btn-sm" id="btn__moins" value="-">\n          <input type="button" class="btn btn-light btn-sm" id="btn__plus" value="+" disabled> \n        </div>\n      '),c.appendChild(a)}}(),t.forEach((function(e){for(var t=document.querySelectorAll("#btn__plus"),n=!0,a=0;a<t.length;a++){var r=t[a].parentElement.parentElement.firstElementChild.firstElementChild.textContent;if(e.qty>=20)return n;e.name===r&&(n=!1,t[a].removeAttribute("disabled"))}})),function(){for(var e=document.querySelectorAll("#btn__moins"),n=document.querySelectorAll("#btn__plus"),a=function(n){var a=e[n].parentElement.parentElement.firstElementChild.firstElementChild.textContent;e[n].addEventListener("click",(function(e){e.stopPropagation(),t.forEach((function(e){e.name===a&&(e.qty--,0===e.qty&&(confirm("Confirmez-vous la suppresion du ".concat(e.name," ?"))?t=t.filter((function(e){return 0!==e.qty})):e.qty++),localStorage.setItem("article",JSON.stringify(t)))})),location.reload()}))},r=0;r<e.length;r++)a(r);for(var o=function(a){var r=e[a].parentElement.parentElement.firstElementChild.firstElementChild.textContent;n[a].addEventListener("click",(function(e){e.stopPropagation(),t.forEach((function(e){e.name===r&&(e.qty++,e.qty>=20?window.alert("Vous avez atteint le maximum de ".concat(e.name)):n[a].removeAttribute("disabled"),localStorage.setItem("article",JSON.stringify(t)))})),location.reload()}))},i=0;i<n.length;i++)o(i)}())}})();